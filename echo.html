<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Эхо повтор</title>
<style>
    body {
        font-family: Arial, sans-serif;
        text-align: center;
        background: #222;
        color: white;
    }
    .board {
        display: grid;
        grid-template-columns: repeat(2, 150px);
        grid-gap: 20px;
        justify-content: center;
        margin-top: 50px;
    }
    .btn {
        width: 150px;
        height: 150px;
        border-radius: 15px;
        cursor: pointer;
        opacity: 0.9;
        transition: 0.2s;
    }
    .red { background: red; }
    .green { background: green; }
    .blue { background: blue; }
    .yellow { background: gold; }
    .active { opacity: 1; box-shadow: 0 0 30px white; }
    #menuBtn {
        display: none;
        margin-top: 30px;
        padding: 10px 20px;
        font-size: 18px;
        cursor: pointer;
    }
</style>
</head>
<body>

<h1>Эхо повтор</h1>
<p id="status">Нажмите любую кнопку, чтобы начать!</p>

<div class="board">
    <div class="btn red" data-color="red"></div>
    <div class="btn green" data-color="green"></div>
    <div class="btn blue" data-color="blue"></div>
    <div class="btn yellow" data-color="yellow"></div>
</div>

<button id="menuBtn" onclick="goToMenu()">Вернуться в меню</button>

<script>
const colors = ["red", "green", "blue", "yellow"];
let sequence = [];
let playerSequence = [];
let round = 0;
let canClick = false;

function startGame() {
    sequence = [];
    playerSequence = [];
    round = 0;
    document.getElementById("status").textContent = "Игра началась!";
    nextRound();
}

function nextRound() {
    canClick = false;
    round++;
    document.getElementById("status").textContent = "Раунд " + round;
    sequence.push(colors[Math.floor(Math.random() * 4)]);
    playerSequence = [];
    playSequence();
}

function playSequence() {
    let delay = 500;
    sequence.forEach((color, index) => {
        setTimeout(() => flashButton(color), delay * (index + 1));
    });
    setTimeout(() => canClick = true, delay * (sequence.length + 1));
}

function flashButton(color) {
    const btn = document.querySelector(`.btn.${color}`);
    btn.classList.add("active");
    setTimeout(() => btn.classList.remove("active"), 300);
}

document.querySelectorAll(".btn").forEach(btn => {
    btn.addEventListener("click", () => {
        if (!canClick) return;
        const color = btn.dataset.color;
        playerSequence.push(color);
        flashButton(color);
        checkMove();
    });
});

function checkMove() {
    const index = playerSequence.length - 1;
    if (playerSequence[index] !== sequence[index]) {
        document.getElementById("status").textContent = "Ошибка! Игра окончена.";
        document.getElementById("menuBtn").style.display = "inline-block";
        canClick = false;
        return;
    }
    if (playerSequence.length === sequence.length) {
        setTimeout(nextRound, 1000);
    }
}

function goToMenu() {
    window.location.href = "index.html";
}

document.body.addEventListener("keydown", startGame);
document.querySelectorAll(".btn").forEach(btn => btn.addEventListener("click", () => {
    if (round === 0) startGame();
}));

</script>
</body>
</html>
